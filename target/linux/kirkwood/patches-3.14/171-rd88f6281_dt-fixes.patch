From 9a5b2aa46d5e692f7d3610472a19b8c4f26e0579 Mon Sep 17 00:00:00 2001
From: Eugene Sanivsky <seugene@marvell.com>
Date: Tue, 19 Aug 2014 18:52:53 +0300
Subject: [PATCH] ARM: Kirkwood: Fix convertion of rd88f6281-setup.c to DT

---
 arch/arm/boot/dts/Makefile                  |  4 +--
 arch/arm/boot/dts/kirkwood-rd88f6281-a.dts  | 47 +++++++++++++++++++++++++++++
 arch/arm/boot/dts/kirkwood-rd88f6281-a0.dts | 26 ----------------
 arch/arm/boot/dts/kirkwood-rd88f6281-a1.dts | 31 -------------------
 arch/arm/boot/dts/kirkwood-rd88f6281.dts    | 42 ++++++++++++++++++++++++++
 arch/arm/boot/dts/kirkwood-rd88f6281.dtsi   | 34 +++++++--------------
 6 files changed, 102 insertions(+), 82 deletions(-)
 create mode 100644 arch/arm/boot/dts/kirkwood-rd88f6281-a.dts
 delete mode 100644 arch/arm/boot/dts/kirkwood-rd88f6281-a0.dts
 delete mode 100644 arch/arm/boot/dts/kirkwood-rd88f6281-a1.dts
 create mode 100644 arch/arm/boot/dts/kirkwood-rd88f6281.dts

diff --git a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
index 3dd2aae..41f850b 100644
--- a/arch/arm/boot/dts/Makefile
+++ b/arch/arm/boot/dts/Makefile
@@ -113,8 +113,8 @@
 	kirkwood-nsa310a.dtb \
 	kirkwood-openblocks_a6.dtb \
 	kirkwood-openblocks_a7.dtb \
-	kirkwood-rd88f6281-a0.dtb \
-	kirkwood-rd88f6281-a1.dtb \
+	kirkwood-rd88f6281.dtb \
+	kirkwood-rd88f6281-a.dtb \
 	kirkwood-pogo_e02.dtb \
 	kirkwood-sheevaplug.dtb \
 	kirkwood-sheevaplug-esata.dtb \
diff --git a/arch/arm/boot/dts/kirkwood-rd88f6281-a.dts b/arch/arm/boot/dts/kirkwood-rd88f6281-a.dts
new file mode 100644
index 0000000..c62242e
--- /dev/null
+++ b/arch/arm/boot/dts/kirkwood-rd88f6281-a.dts
@@ -0,0 +1,47 @@
+/*
+ * Marvell RD-6281-A Board descrition
+ *
+ * Andrew Lunn <andrew@lunn.ch>
+ * Eugene San (eugenesan) <eugenesan@gmail.com>
+ *
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed "as is" without any
+ * warranty of any kind, whether express or implied.
+ *
+ * This file contains the definitions for the second revision of
+ * reference design board, marked as RD-6281-A.
+ * This variant supports A0, A1 and probably newer variants of the SoC.
+ * This board has a dedicated "WAN" port connected to the first ethernet channel.
+ * Switch (LAN1-4) connected to second channel.
+ */
+
+/dts-v1/;
+
+#include "kirkwood-rd88f6281.dtsi"
+
+/ {
+	model = "Marvell RD-6281-A Reference design, with A0/A1 SoC";
+	compatible = "marvell,rd88f6281-a", "marvell,rd88f6281","marvell,kirkwood-88f6281", "marvell,kirkwood";
+
+	dsa@0 {
+		switch@0 {
+			reg = <10 0>;    /* MDIO address 10, switch 0 in tree */
+		};
+	};
+};
+
+&mdio {
+	status = "okay";
+
+	ethphy0: ethernet-phy@11 {
+		reg = <11>;
+	};
+};
+
+&eth1 {
+	status = "okay";
+
+	ethernet1-port@0 {
+		phy-handle = <&ethphy0>;
+	};
+};
diff --git a/arch/arm/boot/dts/kirkwood-rd88f6281-a0.dts b/arch/arm/boot/dts/kirkwood-rd88f6281-a0.dts
deleted file mode 100644
index a803bbb..0000000
--- a/arch/arm/boot/dts/kirkwood-rd88f6281-a0.dts
+++ /dev/null
@@ -1,26 +0,0 @@
-/*
- * Marvell RD88F6181 A0 Board descrition
- *
- * Andrew Lunn <andrew@lunn.ch>
- *
- * This file is licensed under the terms of the GNU General Public
- * License version 2.  This program is licensed "as is" without any
- * warranty of any kind, whether express or implied.
- *
- * This file contains the definitions for the board with the A0 variant of
- * the SoC. The ethernet switch does not have a "wan" port.
- */
-
-/dts-v1/;
-#include "kirkwood-rd88f6281.dtsi"
-
-/ {
-	model = "Marvell RD88f6281 Reference design, with A0 SoC";
-	compatible = "marvell,rd88f6281-a0", "marvell,rd88f6281","marvell,kirkwood-88f6281", "marvell,kirkwood";
-
-	dsa@0 {
-		switch@0 {
-			reg = <10 0>;    /* MDIO address 10, switch 0 in tree */
-		};
-	};
-};
\ No newline at end of file
diff --git a/arch/arm/boot/dts/kirkwood-rd88f6281-a1.dts b/arch/arm/boot/dts/kirkwood-rd88f6281-a1.dts
deleted file mode 100644
index baeebbf..0000000
--- a/arch/arm/boot/dts/kirkwood-rd88f6281-a1.dts
+++ /dev/null
@@ -1,31 +0,0 @@
-/*
- * Marvell RD88F6181 A1 Board descrition
- *
- * Andrew Lunn <andrew@lunn.ch>
- *
- * This file is licensed under the terms of the GNU General Public
- * License version 2.  This program is licensed "as is" without any
- * warranty of any kind, whether express or implied.
- *
- * This file contains the definitions for the board with the A1 variant of
- * the SoC. The ethernet switch has a "wan" port.
- */
-
-/dts-v1/;
-
-#include "kirkwood-rd88f6281.dtsi"
-
-/ {
-	model = "Marvell RD88f6281 Reference design, with A1 SoC";
-	compatible = "marvell,rd88f6281-a1", "marvell,rd88f6281","marvell,kirkwood-88f6281", "marvell,kirkwood";
-
-	dsa@0 {
-		switch@0 {
-			reg = <0 0>;    /* MDIO address 0, switch 0 in tree */
-			port@4 {
-				reg = <4>;
-				label = "wan";
-			};
-		};
-	};
-};
\ No newline at end of file
diff --git a/arch/arm/boot/dts/kirkwood-rd88f6281.dts b/arch/arm/boot/dts/kirkwood-rd88f6281.dts
new file mode 100644
index 0000000..684f629
--- /dev/null
+++ b/arch/arm/boot/dts/kirkwood-rd88f6281.dts
@@ -0,0 +1,42 @@
+/*
+ * Marvell RD-6281 Board descrition
+ *
+ * Andrew Lunn <andrew@lunn.ch>
+ * Eugene San (eugenesan) <eugenesan@gmail.com>
+ *
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed "as is" without any
+ * warranty of any kind, whether express or implied.
+ *
+ * This file contains the definitions for the first revision of
+ * reference design board, marked as RD-6281.
+ * This variant supports Z0 and Z1 variants of the SoC.
+ * This board has a switch (LAN1-4,WAN) connected to second ethernet channel.
+ * First ethernet channel is unused.
+ */
+
+/dts-v1/;
+
+#include "kirkwood-rd88f6281.dtsi"
+
+/ {
+	model = "Marvell RD-6281 Reference design, with Z0/Z1 SoC";
+	compatible = "marvell,rd88f6281", "marvell,rd88f6281","marvell,kirkwood-88f6281", "marvell,kirkwood";
+
+	dsa@0 {
+		switch@0 {
+			reg = <0 0>;    /* MDIO address 0, switch 0 in tree */
+			port@4 {
+				reg = <4>;
+				label = "wan";
+			};
+		};
+	};
+};
+
+&eth1 {
+	status = "disabled";
+
+	ethernet1-port@0 {
+	};
+};
diff --git a/arch/arm/boot/dts/kirkwood-rd88f6281.dtsi b/arch/arm/boot/dts/kirkwood-rd88f6281.dtsi
index d6368c3..e3fce7e 100644
--- a/arch/arm/boot/dts/kirkwood-rd88f6281.dtsi
+++ b/arch/arm/boot/dts/kirkwood-rd88f6281.dtsi
@@ -1,7 +1,8 @@
 /*
- * Marvell RD88F6181 Common Board descrition
+ * Marvell RD6281 Common Board descrition
  *
  * Andrew Lunn <andrew@lunn.ch>
+ * Eugene San (eugenesan) <eugenesan@gmail.com>
  *
  * This file is licensed under the terms of the GNU General Public
  * License version 2.  This program is licensed "as is" without any
@@ -17,7 +18,7 @@
 / {
 	memory {
 		device_type = "memory";
-		reg = <0x00000000 0x20000000>;
+		reg = <0x00000000 0x20000000>; /* 512 MB */
 	};
 
 	chosen {
@@ -69,7 +70,7 @@
 		#size-cells = <0>;
 
 		dsa,ethernet = <&eth0>;
-		dsa,mii-bus = <&ethphy1>;
+		dsa,mii-bus = <&mdio>;
 
 		switch@0 {
 			#address-cells = <1>;
@@ -100,7 +101,7 @@
 				label = "cpu";
 			};
 		};
-       };
+	};
 };
 
 &nand {
@@ -118,35 +119,22 @@
 	};
 
 	partition@300000 {
-		label = "data";
+		label = "rootfs";
 		reg = <0x0300000 0x500000>;
 	};
 };
 
 &mdio {
 	status = "okay";
-
-	ethphy0: ethernet-phy@0 {
-		reg = <0>;
-	};
-
-	ethphy1: ethernet-phy@ff {
-		reg = <0xff>; /* No PHY attached */
-		speed = <1000>;
-		duple = <1>;
-	};
 };
 
 &eth0 {
 	status = "okay";
-	ethernet0-port@0 {
-		phy-handle = <&ethphy0>;
-	};
-};
 
-&eth1 {
-	status = "okay";
-	ethernet1-port@0 {
-		phy-handle = <&ethphy1>;
+	ethernet0-port@0 {
+		fixed-link {
+			speed = <1000>;
+			full-duplex;
+		};
 	};
 };
-- 
2.1.0

